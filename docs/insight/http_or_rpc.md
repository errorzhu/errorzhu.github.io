# 选http还是rpc 

# 误区

我们经常搜到http协议，rpc协议这种说法，虽然都是协议，但混淆了我们的认知。因为这两个协议的定位并不相同，http是传输协议，定义了数据传输的标准。http定义了自己的报文结构，你想发送一条http请求，必须按照报文结构来。而rpc是调用协议，描述了调用规范。至于在这个调用过程中，你使用什么传输协议(http,还是自定义tcp报文)，什么序列化协议(json,还是protobuffer)，都是可选的。所以这两者并不在同一维度，经常混到一起讨论是有问题的。

# 我们真正的问题是什么？
我们真正想知道的是，在我们与其他服务做通信的时候，我们用那种方式？这些方式有什么优缺点？为什么有了http请求，我们还要使用rpc的方式调用服务端提供的接口？

# 那么，怎么选呢
首先rpc比http出现的早，所以在以前rpc才是根正苗红。随着web应用的大流行，我们使用http请求来调用web服务提供的功能的频率才大幅增加。

因此两者的场景不尽相同,rpc更多的用在分布式系统,系统内部的通信;而http请求用于web服务的访问。

分布式系统内部通信可以用http吗？如果内部组件都是web应用，完全没有问题，那统一用http不就完了。
这里就涉及一个哲学问题"什么是内部，什么是外部"。

内部系统意味着高度内聚，namenode必须配合datanode使用，因此内部系统的组件之间，可以的通信规则可以定制，因为只在内部系统使用，所以不需要特别通用。这样我们就可以定向优化，比如减少无用数据的传输，定制压缩格式等方案来提高通信的效率。rpc跨越了应用层和传输层，可以做自己tcp包的封装，非常适合这类场景。

外部系统意味着要提供给外部使用，作为服务提供者，没有权利要求别人以什么样的形式使用自己的服务，人家的客户端愿意用java就java，愿意用c就用c。所以服务提供者应该提供一种更通用，更普及的方式。尤其对于我们来说开发的大多数都是web应用，运行在http容器中，对http请求处理有天然优势，以http请求调用的方式，就更适用这种场景。